<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>AI 업무적용 역량 인증 자가진단</title>
<style>
  :root{
    --bg:#f4f6f8; --card:#fff; --primary:#1466ef; --muted:#6b7280; --radius:12px;
    --gap:12px; --font-size:17px;
  }
  html,body{height:100%;margin:0;padding:0;font-family:system-ui,-apple-system,"Noto Sans KR",Roboto,Arial,sans-serif;background:var(--bg);-webkit-text-size-adjust:none;}
  body{overflow:hidden}
  .wrap{min-height:100vh;box-sizing:border-box;padding:env(safe-area-inset-top) 14px env(safe-area-inset-bottom);display:flex;flex-direction:column;align-items:stretch;}
  header{padding:12px 0 6px;}
  h1{margin:0;font-size:20px}
  .desc{color:var(--muted);font-size:13px;margin-top:6px}
  main{flex:1;margin-top:8px;display:flex;flex-direction:column;gap:12px;overflow:auto;padding-bottom:12px;}
  .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.04);}
  label{display:block;font-size:14px;color:#111;margin-bottom:6px}
  input[type="text"], input[type="tel"], textarea, select{
    width:100%;box-sizing:border-box;padding:12px;border-radius:10px;border:1px solid #e6edf6;font-size:17px;background:#fff;
  }
  .btn-row{display:flex;gap:10px;margin-top:8px;}
  .btn{flex:1;padding:12px;border-radius:10px;border:none;background:var(--primary);color:#fff;font-weight:600;font-size:17px;cursor:pointer}
  .btn.secondary{background:#fff;border:1px solid #d0d7e6;color:#333}
  .progress{font-size:13px;color:#444;margin-bottom:6px}
  .choices{display:flex;flex-direction:column;gap:10px;margin-top:6px}
  .choice{padding:12px;border-radius:10px;background:#f7fbff;border:1px solid #e6eefc;text-align:left;font-size:16px;cursor:pointer;touch-action:manipulation}
  .choice.selected{background:var(--primary);color:#fff;border-color:var(--primary)}
  .result-big{font-size:20px;font-weight:700;color:#111;margin:10px 0}
  .muted{color:var(--muted);font-size:13px}
  .error{color:#b00020;font-size:13px;margin-top:8px}
  body, .wrap, main{min-width:0}
  .debug {font-size:12px;color:#777;margin-top:8px}
</style>
</head>
<body>
  <!--
    NOTE (주소/도메인 팁)
    1) GitHub Pages 기본 주소: https://<username>.github.io/<repo>/
       - repo 루트의 index.html 또는 docs/ 폴더를 배포 브랜치로 사용하면 해당 주소로 서비스 가능.
    2) 좀 더 '공식' 느낌의 주소를 원하면:
       - 리포지토리 이름을 바꾸어 보이게 할 수 있음 (예: ai-cert, ai-assessment 등)
       - 또는 커스텀 도메인 사용: 리포지토리 Settings > Pages > Custom domain에 회사 테스트용 서브도메인(CNAME) 설정.
         (회사 DNS팀에 CNAME/ALIAS 등록 필요)
    3) 조직 계정의 GitHub Pages(예: https://kb-company.github.io/ai-assessment)로 만들면 더 공식 느낌 가능.
    4) 요약: "리포지토리명 변경" 또는 "커스텀 도메인(CNAME)" 적용으로 주소 느낌을 개선하세요.
  -->

  <div class="wrap" role="application">
    <header>
      <h1>AI 업무적용 역량 인증 자가진단</h1>
      <div class="desc">본 테스트는 시험이 아니며, AI 활용 경험 수준을 확인하기 위한 진단입니다. 하단의 보기 중 본인의 경험과 가장 적합한 것을 골라주세요.(1개만 선택 가능)</div>
    </header>

    <main id="mainArea">
      <!-- Intro -->
      <div id="intro" class="card" aria-labelledby="introTitle">
        <label for="name">이름</label>
        <input id="name" type="text" placeholder="홍길동" autocomplete="name" />

        <label for="employee">사번 (예: K123456)</label>
        <input id="employee" type="text" placeholder="K123456" inputmode="text" />

        <label for="dept">부서</label>
        <input id="dept" type="text" placeholder="부서명" />

        <div id="introError" class="error" style="display:none"></div>

        <div style="height:8px"></div>
        <div class="btn-row">
          <button id="startBtn" class="btn" disabled>시작하기</button>
        </div>
        <div style="font-size:12px;color:#777;margin-top:8px">입력 후 '시작하기'를 눌러주세요. 제출 후 수정 불가.</div>
      </div>

      <!-- Survey -->
      <div id="survey" class="card" style="display:none">
        <div class="progress">STEP <span id="stepNum">1</span> / <span id="totalSteps">8</span></div>
        <div id="questionWrap"></div>
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px;">
          <button id="prevBtn" class="btn secondary" style="flex:0 0 120px;display:none">이전</button>
          <button id="nextBtn" class="btn" style="flex:1;display:none">다음</button>
        </div>
      </div>

      <!-- Result -->
      <div id="result" class="card" style="display:none">
        <div class="result-big">진단 결과</div>
        <div>총점: <strong id="totalScore">0</strong></div>
        <div style="margin-top:8px">판정: <strong id="category">-</strong></div>
        <div style="margin-top:10px;color:#666">문의: HR부 백인광(2966)</div>
        <div style="height:12px"></div>
        <div style="display:flex;gap:8px;">
          <button id="doneBtn" class="btn">제출 완료</button>
        </div>
        <div id="saveMsg" style="margin-top:12px"></div>
      </div>
    </main>

  </div>

<script>
/* POST endpoint */
const POST_ENDPOINT = "https://script.google.com/macros/s/AKfycby-PE4j9gCV36jZKDFLyl8DoL2wJ50P7uZ92_Lxzq3J2lMPKYI9LWI-mTb0iKEY3f5-8A/exec";

/* 질문/선지/점수(8문항) */
const questions = [
  {"id":"Q1","text":"최근 업무에서 생성형 AI를 실제로 사용해본 경험에 가장 가까운 것은 무엇인가요?","choices":[
    {"k":"a","t":"업무에서는 사용해본 적 없음 (개인적으로 궁금해서 한두 번 질문해본 정도)","s":0},
    {"k":"b","t":"업무 중 참고용으로 1~2회 사용 (내용 확인, 아이디어 참고 수준)","s":3},
    {"k":"c","t":"요약·초안 작성 등 업무 보조로 가끔 사용 (결과를 일부 업무에 반영)","s":5},
    {"k":"d","t":"반복 업무(보고서, 자료정리 등)에 정기적으로 사용 (주 1회 이상)","s":8},
    {"k":"e","t":"AI를 본인 업무에 맞게 주도적이고 능동적으로 사용 (업무 흐름에 자연스럽게 포함)","s":10}]},
  {"id":"Q2","text":"AI를 활용해 직접 수행해본 업무 형태에 가장 가까운 것은 무엇인가요?","choices":[
    {"k":"a","t":"단순 정보 질문만 수행","s":0},
    {"k":"b","t":"(1 포함) 문서 내용을 빠르게 파악하기 위한 요약만 수행","s":3},
    {"k":"c","t":"(1,2 포함)보고서·메일 등의 초안을 작성","s":5},
    {"k":"d","t":"(1~3 포함)자료 조사·정리까지 포함한 업무를 수행","s":8},
    {"k":"e","t":"(1~4 포함)자료 분석, 보고 등 업무 맞춤형 사용","s":10}]},
  {"id":"Q3","text":"AI에게 질문할 때, 실제로 가장 자주 사용했던 방식은 무엇인가요?","choices":[
    {"k":"a","t":"한 문장으로 간단히 요청 (예: “이 문서 요약해줘”)","s":0},
    {"k":"b","t":"결과의 형식이나 분량만 지정 (예: “이 문서를 5줄로 요약해줘”, “표로 정리해줘”)","s":4},
    {"k":"c","t":"업무 상황을 함께 설명 (예: “이 문서는 카드업 관련 보고서야. 우리 회사 관점에서 핵심만 요약해줘”)","s":7},
    {"k":"d","t":"AI에게 역할을 부여해 요청 (예: “너는 카드 기획 담당자야. 이 보고서의 시사점을 정리해줘”)","s":11},
    {"k":"e","t":"판단·대안·권고안까지 요구 (예: “가능한 대안을 비교하고, 추천안을 제시해줘”)","s":15}]},
  {"id":"Q4","text":"AI 결과가 기대와 다를 때, 실제로 해본 행동에 가장 가까운 것은 무엇인가요?","choices":[
    {"k":"a","t":"그대로 사용하거나 더 이상 사용하지 않음 (수정·재질문 없이 종료)","s":0},
    {"k":"b","t":"같은 질문을 다시 입력 (예: “다시 한 번 써줘”)","s":4},
    {"k":"c","t":"분량·관점 등 조건을 조금 바꿔 재질문 (예: “조금 더 짧게”, “마케팅 관점으로”)","s":7},
    {"k":"d","t":"결과를 보고 구체적으로 수정 요청 (예: “이 문단은 빼고, 사례를 추가해줘”)","s":11},
    {"k":"e","t":"질문을 단계로 나눠 재구성 (요약 → 정리 → 검증 순으로 나눠 질문)","s":15}]},
  {"id":"Q5","text":"AI에 파일(PDF, 엑셀 등)을 업로드해 실제로 활용해본 수준은 어느 정도인가요?","choices":[
    {"k":"a","t":"파일 업로드를 사용해본 적 없음","s":0},
    {"k":"b","t":"파일은 업로드해봤으나 결과가 애매해 업무에 쓰지는 않음","s":4},
    {"k":"c","t":"단일 파일을 요약하는 정도 (예: “이 PDF 핵심만 정리해줘”)","s":7},
    {"k":"d","t":"파일을 기준으로 특정 정보·수치를 질문 (예: “이 엑셀에서 매출 상위 항목은?”)","s":11},
    {"k":"e","t":"여러 파일을 비교·분석해 시사점을 도출 (예: 여러 보고서 비교 후 공통 이슈 정리)","s":15}]},
  {"id":"Q6","text":"파일 기반 작업에서 경험은?","choices":[
    {"k":"a","t":"파일 요약만 수행 (읽기 보조 수준)","s":0},
    {"k":"b","t":"파일에서 특정 문장·값을 찾아봄 (예: “이 문서에서 ○○가 언급된 부분은?”)","s":4},
    {"k":"c","t":"여러 파일의 공통점·차이점을 비교 (예: 보고서 A vs B 비교)","s":7},
    {"k":"d","t":"엑셀 표를 기준으로 필터·합계·조건 질의 (예: “조건별 합계”, “상위 10개”)","s":11},
    {"k":"e","t":"파일 내용의 오류·불일치를 발견해 재질문 (수치 불일치 지적, 재확인 요청)","s":15}]},
  {"id":"Q7","text":"AI 결과를 실제 업무에 적용할 때, 가장 가까웠던 행동은 무엇인가요?","choices":[
    {"k":"a","t":"별도 검토 없이 그대로 사용","s":0},
    {"k":"b","t":"중요해 보이는 부분만 빠르게 확인 (간단히 훑어봄)","s":3},
    {"k":"c","t":"수치·사실 오류가 없는지 확인 (금액, 건수 등 체크)","s":5},
    {"k":"d","t":"논리·표현·근거를 수정해 반영 (보고서 품질 개선)","s":8},
    {"k":"e","t":"AI 결과는 참고로만 두고 최종 산출물은 본인이 다시 정리·작성","s":10}]},
  {"id":"Q8","text":"AI를 업무에 활용하면서 실제로 해본 보안 관련 행동에 가장 가까운 것은 무엇인가요?","choices":[
    {"k":"a","t":"어떤 정보가 위험한지 잘 몰라 그대로 입력한 적이 있음","s":0},
    {"k":"b","t":"민감해 보이는 정보는 피해야 한다고 생각해 봤으나, 실제 조치는 해본 적 없음","s":3},
    {"k":"c","t":"개인정보·카드정보 등은 삭제하거나 제외하고 입력(주민번호, 카드번호 등)","s":5},
    {"k":"d","t":"내부 문서 원문 대신 요약·가공된 내용만 입력","s":8},
    {"k":"e","t":"AI 결과를 활용하되, 외부 공유·의사결정 전 반드시 재검토 후 사용","s":10}]}
];

let answers = Array(questions.length).fill(null);
let scores = Array(questions.length).fill(0);
let current = 0;
let user = {name:"", emp:"", dept:""};
let saving = false;

/* DOM */
const mainArea = document.getElementById('mainArea');
const introEl = document.getElementById('intro');
const surveyEl = document.getElementById('survey');
const resultEl = document.getElementById('result');
const startBtn = document.getElementById('startBtn');
const nameInp = document.getElementById('name');
const empInp = document.getElementById('employee');
const deptInp = document.getElementById('dept');
const introError = document.getElementById('introError');
const qWrap = document.getElementById('questionWrap');
const stepNum = document.getElementById('stepNum');
const totalSteps = document.getElementById('totalSteps');
const prevBtn = document.getElementById('prevBtn');
const doneBtn = document.getElementById('doneBtn');
const totalScoreEl = document.getElementById('totalScore');
const categoryEl = document.getElementById('category');
const saveMsg = document.getElementById('saveMsg');

totalSteps.innerText = questions.length;

/* validation/start */
function validateIntroInputs(){
  const n = nameInp.value.trim(), e = empInp.value.trim(), d = deptInp.value.trim();
  const pat = /^K\d{6}$/i;
  startBtn.disabled = !(n && e && d && pat.test(e));
  if(!startBtn.disabled) introError.style.display = 'none';
}
/* event listeners: input + keyup + change + compositionend (IME) */
[nameInp, empInp, deptInp].forEach(i => {
  i.addEventListener('input', validateIntroInputs);
  i.addEventListener('keyup', validateIntroInputs);
  i.addEventListener('change', validateIntroInputs);
  i.addEventListener('compositionend', validateIntroInputs);
});

startBtn.addEventListener('click', ()=> {
  const n = nameInp.value.trim(), e = empInp.value.trim(), d = deptInp.value.trim();
  const pat = /^K\d{6}$/i;
  if(!n || !e || !d){ introError.innerText = '이름·사번·부서를 모두 입력해주세요.'; introError.style.display='block'; return; }
  if(!pat.test(e)){ introError.innerText = '사번 형식 오류입니다. 예: K123456'; introError.style.display='block'; return; }
  user = { name: n, emp: e.toUpperCase(), dept: d };
  introEl.style.display = 'none';
  surveyEl.style.display = 'block';
  renderQuestion(0);
  setTimeout(()=> recalcMainHeight(), 60);
});

/* render */
function renderQuestion(idx){
  current = idx;
  stepNum.innerText = idx+1;
  const q = questions[idx];
  qWrap.innerHTML = '';
  const title = document.createElement('div');
  title.style.fontWeight='700'; title.style.fontSize='16px'; title.style.marginBottom='8px';
  title.innerText = q.text;
  qWrap.appendChild(title);

  const list = document.createElement('div'); list.className='choices';
  q.choices.forEach((c,i)=>{
    const el = document.createElement('button');
    el.type = 'button';
    el.className = 'choice';
    el.innerText = c.t;
    el.addEventListener('click', ()=> {
      answers[idx] = c.k;
      scores[idx] = c.s;
      Array.from(list.children).forEach((ch,ci)=> ch.classList.toggle('selected', ci===i));
      setTimeout(()=> {
        if(idx < questions.length-1) renderQuestion(idx+1);
        else finalize();
      }, 160);
    });
    el.addEventListener('keydown', ev=> { if(ev.key==='Enter' || ev.key===' ') el.click(); });
    list.appendChild(el);
  });
  qWrap.appendChild(list);
  prevBtn.style.display = idx===0 ? 'none' : 'inline-block';
  mainArea.scrollTop = 0;
  setTimeout(()=> recalcMainHeight(), 40);
}
prevBtn.addEventListener('click', ()=> { if(current>0) renderQuestion(current-1); });

/* finalize */
function computeTotal(){ return scores.reduce((a,b)=> a + (parseFloat(b)||0), 0); }
function classify(total){
  if(total >= 70) return "산출물 트랙(교육 불필요)";
  if(total >= 40) return "교육 트랙(수강 필수)";
  return "기초 안내 대상";
}
function finalize(){
  surveyEl.style.display = 'none';
  resultEl.style.display = 'block';
  const total = computeTotal();
  totalScoreEl.innerText = total;
  categoryEl.innerText = classify(total);
  setTimeout(()=> recalcMainHeight(), 60);
}

/* --- submit: form-urlencoded --- */
doneBtn.addEventListener('click', async ()=> {
  if(saving) return;
  const ok = confirm('제출 완료 후 응답 수정은 불가능합니다. 제출하시겠습니까?');
  if(!ok) return;

  saving = true;
  doneBtn.disabled = true;
  saveMsg.innerText = '제출 중';

  const payload = {
    submitted_at: new Date().toISOString(),
    name: user.name,
    employeeId: user.emp,
    department: user.dept,
    totalScore: computeTotal(),
    category: classify(computeTotal()),
    answers: answers,
    scores: scores,
    userAgent: navigator.userAgent
  };

  if(!POST_ENDPOINT){
    saveMsg.innerText = '저장 기능이 설정되어 있지 않습니다 (POST_ENDPOINT 비어있음).';
    doneBtn.disabled = false;
    saving = false;
    return;
  }

  try {
    // form-urlencoded
    const form = new URLSearchParams();
    form.append('submitted_at', payload.submitted_at);
    form.append('name', payload.name);
    form.append('employeeId', payload.employeeId);
    form.append('department', payload.department);
    form.append('totalScore', String(payload.totalScore));
    form.append('category', payload.category);
    form.append('answers', JSON.stringify(payload.answers));
    form.append('scores', JSON.stringify(payload.scores));
    form.append('userAgent', payload.userAgent);

    // debug: console output only (no on-screen raw response)
    console.log('DEBUG: POST_ENDPOINT=', POST_ENDPOINT);
    console.log('DEBUG: Sending content-type: application/x-www-form-urlencoded;charset=UTF-8');
    console.log('DEBUG: form body=', form.toString());

    const res = await fetch(POST_ENDPOINT + '?_ts=' + Date.now(), {
      method: 'POST',
      cache: 'no-store',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: form.toString()
    });

    // Try to read response text
    let txt = '';
    try { txt = await res.text(); } catch(e){ txt = ''; console.warn('response read failed', e); }

    let j = null;
    try { j = txt ? JSON.parse(txt) : null; } catch(e){ j = null; }

    if(res.ok && (j && j.status === 'ok' || !j)){
      saveMsg.innerText = '제출이 완료되었습니다.';
    } else if (j && j.status === 'duplicate'){
      saveMsg.innerText = '중복 제출로 저장되지 않았습니다.';
      doneBtn.disabled = true;
    } else {
      saveMsg.innerText = '저장 실패: ' + (j && j.message ? j.message : txt || '서버 응답 오류');
      doneBtn.disabled = false;
      saving = false;
      return;
    }

  } catch(err){
    console.error('submit error', err);
    saveMsg.innerText = '저장 실패. 네트워크 상태를 확인하세요.';
    doneBtn.disabled = false;
    saving = false;
    return;
  }

  doneBtn.disabled = true;
  saving = false;
});

/* viewport handling (same as before) */
let recalcTimer = null;
function recalcMainHeight(){
  if(recalcTimer) clearTimeout(recalcTimer);
  recalcTimer = setTimeout(()=> {
    recalcTimer = null;
    try{
      const headerH = document.querySelector('header')?.getBoundingClientRect().height || 64;
      const footH = 0;
      const vv = (window.visualViewport && window.visualViewport.height) ? window.visualViewport.height : window.innerHeight;
      const avail = Math.max(220, Math.floor(vv - headerH - footH - 24));
      const main = document.getElementById('mainArea');
      if(main){
        main.style.height = avail + 'px';
        main.style.maxHeight = avail + 'px';
        main.style.minHeight = avail + 'px';
      }
    }catch(e){ console.warn(e) }
  }, 60);
}
if(window.visualViewport){
  window.visualViewport.addEventListener('resize', ()=> recalcMainHeight());
  window.visualViewport.addEventListener('scroll', ()=> recalcMainHeight());
}
window.addEventListener('resize', ()=> recalcMainHeight());
window.addEventListener('orientationchange', ()=> setTimeout(recalcMainHeight,120));
window.addEventListener('load', ()=> setTimeout(recalcMainHeight,120));

/* focus handling */
[nameInp, empInp, deptInp].forEach(inp=>{
  inp.addEventListener('focus', ()=> { inp.style.fontSize = '17px'; setTimeout(()=> recalcMainHeight(), 120); });
  inp.addEventListener('blur', ()=> setTimeout(()=> recalcMainHeight(), 60));
});

/* prevent double-tap zoom */
let lastTouch = 0;
document.addEventListener('touchend', function(e){
  const now = Date.now();
  if(now - lastTouch < 300){
    e.preventDefault();
  }
  lastTouch = now;
}, {passive:false});
</script>
</body>
</html>
